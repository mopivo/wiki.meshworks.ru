# Практики ведения GitHub‑репозиториев MeshWorks

Документ описывает базовые правила, которые стоит применять в любых репозиториях MeshWorks (не только wiki). Используйте его как чеклист при заводе нового проекта или ревизии существующего.

## 1. Репозиторий и доступ
- **README по делу** – кратко описываем проект, команды для старта и ссылку на CONTRIBUTING.
- **CONTRIBUTING** – объясняем процесс PR, требования к front matter/линтам/CI.
- **CODEOWNERS** – чтобы нужные люди автоматически получали ревью.
- **Branch protection** – `main` закрыт от прямых пушей, минимум 1 review + зелёный CI.

## 2. CI/CD и автоматизация
- **Разделяйте привилегии**: сборка на `pull_request`, деплой только через `workflow_run` или `workflow_dispatch`.
- **Явные `permissions`** в каждом workflow (`contents: read`, `actions: read` и т.д.).
- **Checkout только доверенного SHA**: для `workflow_run` используем `github.event.workflow_run.head_sha`, отключаем `persist-credentials`.
- **Артефакты = недоверенные**: проверяйте наличие, логируйте fallback, не деплойте “пустое”.
- **Secrets** – хранение только в GitHub Secrets/Envs, не в README или runbook в репозитории.
- **Dependabot/Renovate** – чтобы npm/actions не устаревали.

## 3. Контент и истории коммитов
- **Никаких прод‑деталей**: IP, `/opt/compose`, Bitwarden и т.п. остаются во внутренней документации (`~/.codex/docs`).
- **В README/CONTRIBUTING** даём только пользовательские инструкции (как контрибьютить, где артефакты), без описания секретов или серверов.
- **Single source of truth**: если есть внутренняя дока, публичный реп не должен её дублировать.

## 4. Деплой
- **Собираем на runner’е**: деплой таскает готовый `build/`, а сервер лишь синхронизирует и перезапускает сервис.
- **Sanity‑checks**: автоматический `curl -I` + ручной визуальный осмотр.
- **Fallback**: если артефакт отсутствует, workflow должен уметь пересобрать проект, а не оставлять прод пустым.

## 5. Чеклист перед публикацией репы
1. README и CONTRIBUTING без внутренних деталей, ссылки на полезные страницы.
2. `.github/` содержит:
   - `ci.yml` (линт/сборка, upload artifact, явные permissions);
   - `deploy.yml` (workflow_run + fallback, explicit permissions);
   - `CODEOWNERS`, `dependabot.yml`.
3. Branch protection и required CI настроены.
4. Проверили CodeQL (Security → Code scanning → run) – нет критических alerтов.
5. Убедились, что деплой и сайт проходят smoke‑тест.

Обновляйте этот документ, если появляются новые требования (новая политика GitHub, регламент по security и т.д.).
